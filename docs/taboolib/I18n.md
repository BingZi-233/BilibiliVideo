# I18n 模块

## 概述
I18n (国际化) 模块提供多语言支持功能，允许插件支持多种语言，提升用户体验。

## 功能特性
- 多语言文件管理
- 动态语言切换
- 占位符支持
- 语言文件热重载
- 默认语言回退
- **顶级扩展函数：sendInfo/sendWarn/sendError**
- 跨平台支持 (CommandSender, Player, ProxyCommandSender, ProxyPlayer)

## 安装配置
在 `build.gradle.kts` 中配置：
```kotlin
taboolib {
    env {
        install(I18n)
    }
}
```

## 顶级扩展函数

TabooLib I18n 提供了便捷的顶级扩展函数，可以直接在各种发送者对象上调用：

### 支持的发送者类型
- **CommandSender** (Bukkit 原生)
- **Player** (Bukkit 玩家)
- **ProxyCommandSender** (TabooLib 跨平台)
- **ProxyPlayer** (TabooLib 跨平台玩家)

### 三种消息类型函数

```kotlin
import taboolib.module.lang.*

// 信息消息 (通常为绿色/正面消息)
player.sendInfo("purchaseSuccess", "item" to "钻石剑", "price" to 100)
sender.sendInfo("teleportSuccess", "target" to targetPlayer.name)

// 警告消息 (通常为黄色/警示消息)
player.sendWarn("lowBalance", "current" to balance, "required" to cost)
sender.sendWarn("limitedAccess")

// 错误消息 (通常为红色/错误消息)
player.sendError("playerNotFound", "name" to targetName)
sender.sendError("insufficientPermissions")
```

### 语言文件配置
配合顶级函数使用的语言文件结构：

**zh_CN.yml**:
```yaml
# 商店消息
purchaseSuccess: "&a成功购买 {item}，花费 {price} 金币！"

# 经济消息  
lowBalance: "&e余额不足！当前: &c{current}&e，需要: &c{required}"

# 命令消息
teleportSuccess: "&a已传送到 {target}！"

# 权限消息
limitedAccess: "&e你的权限有限，部分功能可能不可用"

# 错误消息
playerNotFound: "&c找不到玩家: {name}"
insufficientPermissions: "&c权限不足，无法执行此操作！"
```

## 基本用法

### 语言文件结构
在 `src/main/resources/lang/` 目录下创建语言文件：

**zh_CN.yml** (中文):
```yaml
# 基础消息
welcomeMessage: "&a欢迎来到服务器，{player}！"
goodbyeMessage: "&c再见，{player}！"
noPermission: "&c你没有权限执行此操作！"

# 错误消息
playerNotFound: "&c未找到玩家: {player}"
invalidNumber: "&c无效的数字: {input}"

# 命令消息
commandHelp: "&e命令帮助："
reloadSuccess: "&a配置重载成功！"
```

**en_US.yml** (英文):
```yaml
# Basic messages
welcomeMessage: "&aWelcome to the server, {player}!"
goodbyeMessage: "&cGoodbye, {player}!"
noPermission: "&cYou don't have permission to perform this action!"

# Error messages  
playerNotFound: "&cPlayer not found: {player}"
invalidNumber: "&cInvalid number: {input}"

# Command messages
commandHelp: "&eCommand Help:"
reloadSuccess: "&aConfiguration reloaded successfully!"
```

### 基本消息发送
```kotlin
import taboolib.module.lang.*

// 使用顶级扩展函数发送消息
player.sendInfo("welcomeMessage", "player" to player.name)
player.sendWarn("warningMessage")
player.sendError("noPermission")

// 对于 ProxyCommandSender (跨平台)
sender.sendInfo("commandSuccess")
sender.sendWarn("commandWarning") 
sender.sendError("commandError")

// 传统方式 - 发送语言消息
player.sendLang("welcomeMessage", "player" to player.name)

// 获取语言文本
val welcomeMessage = player.asLangText("welcomeMessage", "player" to player.name)
player.sendMessage(welcomeMessage)
```

### 多参数消息
```kotlin
// 语言文件中的消息
// transferSuccess: "&a成功转账 {amount} 金币给 {target}！"

player.sendLang(
    "transferSuccess",
    "amount" to 1000,
    "target" to targetPlayer.name
)
```

### 错误处理
```kotlin
import taboolib.module.lang.Language

// 检查语言键是否存在
if (Language.hasKey("customError")) {
    player.sendLang("customError")
} else {
    player.sendMessage("§c发生了未知错误！")
}

// 使用默认值
val message = player.asLangText("unknownError", default = "§c未知错误")
```

## 高级功能

### 动态语言切换
```kotlin
import taboolib.module.lang.Language

// 设置玩家语言
Language.setPlayerLanguage(player, "en_US")

// 获取玩家当前语言
val currentLang = Language.getPlayerLanguage(player)
player.sendMessage("§e当前语言: $currentLang")

// 临时使用指定语言
val englishMessage = Language.getTextWithLanguage("en_US", "welcomeMessage", "player" to player.name)
```

### 列表消息
```yaml
# 语言文件
shopItemList:
  - "&e=== 商店物品列表 ==="
  - "&f1. 钻石剑 - &a100金币"
  - "&f2. 钻石镐 - &a80金币"
  - "&f3. 钻石甲 - &a200金币"
  - "&e====================="
```

```kotlin
// 发送列表消息
player.sendLang("shopItemList")

// 获取列表消息
val itemList = player.asLangTextList("shopItemList")
itemList.forEach { line ->
    player.sendMessage(line)
}
```

### 条件消息
```kotlin
// 语言文件
balanceHigh: "&a你的余额很充足: {balance} 金币"
balanceMedium: "&e你的余额: {balance} 金币" 
balanceLow: "&c余额不足: {balance} 金币"

// 代码中使用
val balance = getPlayerBalance(player)
val messageKey = when {
    balance >= 10000 -> "balanceHigh"
    balance >= 1000 -> "balanceMedium"
    else -> "balanceLow"
}

player.sendLang(messageKey, "balance" to balance)
```

### 复杂占位符
```yaml
# 语言文件
playerInfo: |
  &e=== 玩家信息 ===
  &f姓名: &a{player}
  &f等级: &b{level}
  &f经验: &d{exp}/{maxExp}
  &f生命值: &c{health}/{maxHealth}
  &f金币: &e{money}
  &e================
```

```kotlin
player.sendLang("playerInfo",
    "player" to player.name,
    "level" to player.level,
    "exp" to player.exp,
    "maxExp" to player.expToLevel,
    "health" to player.health.toInt(),
    "maxHealth" to player.maxHealth.toInt(),
    "money" to getPlayerMoney(player)
)
```

### 语言文件管理
```kotlin
import taboolib.module.lang.Language

// 重载语言文件
Language.reload()

// 添加自定义语言文件路径
Language.addLanguageFile("custom/messages.yml")

// 设置默认语言
Language.setDefaultLanguage("zh_CN")
```

## 实用示例

### 命令中的多语言支持
```kotlin
@CommandBody
object MultiLangCommand {
    
    @CommandHeader(name = "money")
    fun main(sender: ProxyCommandSender) {
        if (sender !is Player) {
            sender.sendError("playerOnly") // 使用 sendError
            return
        }
        
        val balance = getPlayerBalance(sender)
        sender.sendInfo("commandBalance", "balance" to balance) // 使用 sendInfo
    }
    
    @SubCommand("pay")
    fun pay(
        sender: ProxyCommandSender,
        @CommandArgument("player") target: Player,
        @CommandArgument("amount") amount: Double
    ) {
        val senderPlayer = sender as Player
        
        if (amount <= 0) {
            sender.sendError("invalidAmount", "amount" to amount)
            return
        }
        
        if (getPlayerBalance(senderPlayer) < amount) {
            sender.sendError("insufficientFunds") // 错误消息
            return
        }
        
        // 执行转账
        transferMoney(senderPlayer, target, amount)
        
        // 成功消息
        sender.sendInfo("paySuccess", "amount" to amount, "target" to target.name)
        target.sendInfo("payReceived", "amount" to amount, "sender" to sender.name)
        
        // 警告消息 (如果余额较低)
        if (getPlayerBalance(senderPlayer) < 1000) {
            sender.sendWarn("lowBalanceWarning")
        }
    }
}
```

## 注意事项
- 语言文件使用 UTF-8 编码
- 占位符使用 `{key}` 格式
- **语言文件中使用 `&` 而不是 `§` 进行颜色代码，TabooLib 会自动转换**
- 支持 YAML 的多行文本和列表
- 未找到语言键时会显示键名
- 建议为所有用户可见的消息提供多语言支持
- 语言文件结构为扁平结构，使用小驼峰命名